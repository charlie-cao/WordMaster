# ğŸ“¨ æ¶ˆæ¯é˜Ÿåˆ—ä¸æ•°æ®åº“è¯»å†™åˆ†ç¦»æ–¹æ¡ˆ

## ğŸ“‹ ç›®å½•
1. [æ¶ˆæ¯é˜Ÿåˆ—åº”ç”¨åœºæ™¯](#æ¶ˆæ¯é˜Ÿåˆ—åº”ç”¨åœºæ™¯)
2. [æ•°æ®åº“è¯»å†™åˆ†ç¦»æ–¹æ¡ˆ](#æ•°æ®åº“è¯»å†™åˆ†ç¦»æ–¹æ¡ˆ)
3. [æŠ€æœ¯æ¶æ„è®¾è®¡](#æŠ€æœ¯æ¶æ„è®¾è®¡)
4. [å®æ–½è®¡åˆ’](#å®æ–½è®¡åˆ’)
5. [ç›‘æ§ä¸è¿ç»´](#ç›‘æ§ä¸è¿ç»´)

---

## ğŸ“¨ æ¶ˆæ¯é˜Ÿåˆ—åº”ç”¨åœºæ™¯

### 1. å­¦ä¹ è¿›åº¦å¼‚æ­¥å¤„ç†

#### å½“å‰é—®é¢˜
- ç”¨æˆ·å­¦ä¹ è¿›åº¦æ›´æ–°é¢‘ç¹ï¼Œæ¯æ¬¡éƒ½éœ€è¦åŒæ­¥å†™å…¥æ•°æ®åº“
- å­¦ä¹ ç»Ÿè®¡è®¡ç®—å¤æ‚ï¼Œå½±å“å®æ—¶å“åº”
- è‰¾å®¾æµ©æ–¯å¤ä¹ ç®—æ³•è®¡ç®—è€—æ—¶

#### è§£å†³æ–¹æ¡ˆ
```typescript
// å­¦ä¹ è¿›åº¦æ›´æ–°æ¶ˆæ¯
interface LearningProgressMessage {
  type: 'PROGRESS_UPDATE';
  userId: string;
  wordId: string;
  isCorrect: boolean;
  timestamp: Date;
  sessionId: string;
}

// å‘é€æ¶ˆæ¯åˆ°é˜Ÿåˆ—
await messageQueue.send('learning-progress', {
  type: 'PROGRESS_UPDATE',
  userId: 'user123',
  wordId: 'word456',
  isCorrect: true,
  timestamp: new Date(),
  sessionId: 'session789'
});
```

#### æ€§èƒ½æå‡
- **å“åº”æ—¶é—´**: ä» 100-200ms é™ä½åˆ° 10-20ms
- **å¹¶å‘å¤„ç†**: æ”¯æŒé«˜å¹¶å‘å­¦ä¹ è¿›åº¦æ›´æ–°
- **æ•°æ®ä¸€è‡´æ€§**: å¼‚æ­¥å¤„ç†ä¿è¯æ•°æ®å®Œæ•´æ€§

### 2. ç”¨æˆ·ç»Ÿè®¡è®¡ç®—

#### å½“å‰é—®é¢˜
- ç”¨æˆ·ç»Ÿè®¡æ•°æ®å®æ—¶è®¡ç®—ï¼Œå½±å“APIå“åº”
- æ’è¡Œæ¦œã€æˆå°±ç³»ç»Ÿè®¡ç®—å¤æ‚
- å­¦ä¹ çƒ­åŠ›å›¾ç”Ÿæˆè€—æ—¶

#### è§£å†³æ–¹æ¡ˆ
```typescript
// ç”¨æˆ·ç»Ÿè®¡æ›´æ–°æ¶ˆæ¯
interface UserStatsMessage {
  type: 'STATS_UPDATE';
  userId: string;
  statsType: 'daily' | 'weekly' | 'monthly';
  data: {
    wordsLearned: number;
    studyTime: number;
    streak: number;
  };
  timestamp: Date;
}

// æ‰¹é‡å¤„ç†ç»Ÿè®¡æ›´æ–°
await messageQueue.send('user-stats', {
  type: 'STATS_UPDATE',
  userId: 'user123',
  statsType: 'daily',
  data: { wordsLearned: 10, studyTime: 1800, streak: 5 },
  timestamp: new Date()
});
```

### 3. æ¨èç³»ç»Ÿå¤„ç†

#### å½“å‰é—®é¢˜
- æ¨èç»Ÿè®¡èšåˆæŸ¥è¯¢å¤æ‚
- æ¨èå¥–åŠ±è®¡ç®—è€—æ—¶
- æ¨èç éªŒè¯é¢‘ç¹

#### è§£å†³æ–¹æ¡ˆ
```typescript
// æ¨èäº‹ä»¶æ¶ˆæ¯
interface ReferralMessage {
  type: 'REFERRAL_EVENT';
  eventType: 'SIGNUP' | 'ACTIVATION' | 'REWARD';
  referrerId: string;
  refereeId?: string;
  referralCode: string;
  rewardPoints?: number;
  timestamp: Date;
}

// æ¨èäº‹ä»¶å¤„ç†
await messageQueue.send('referral-events', {
  type: 'REFERRAL_EVENT',
  eventType: 'SIGNUP',
  referrerId: 'user123',
  refereeId: 'user456',
  referralCode: 'ABC123',
  timestamp: new Date()
});
```

### 4. æ•°æ®åŒæ­¥ä¸å¤‡ä»½

#### å½“å‰é—®é¢˜
- æ•°æ®åº“å¤‡ä»½å½±å“æ€§èƒ½
- æ•°æ®åŒæ­¥å»¶è¿Ÿ
- æ—¥å¿—è®°å½•å½±å“å“åº”æ—¶é—´

#### è§£å†³æ–¹æ¡ˆ
```typescript
// æ•°æ®åŒæ­¥æ¶ˆæ¯
interface DataSyncMessage {
  type: 'DATA_SYNC';
  collection: string;
  operation: 'INSERT' | 'UPDATE' | 'DELETE';
  data: any;
  timestamp: Date;
}

// å¼‚æ­¥æ•°æ®åŒæ­¥
await messageQueue.send('data-sync', {
  type: 'DATA_SYNC',
  collection: 'users',
  operation: 'UPDATE',
  data: { userId: 'user123', stats: updatedStats },
  timestamp: new Date()
});
```

### 5. é€šçŸ¥ç³»ç»Ÿ

#### å½“å‰é—®é¢˜
- å­¦ä¹ æé†’ã€æˆå°±é€šçŸ¥éœ€è¦å®æ—¶å‘é€
- é‚®ä»¶ã€çŸ­ä¿¡å‘é€è€—æ—¶
- æ¨é€é€šçŸ¥éœ€è¦æ’é˜Ÿå¤„ç†

#### è§£å†³æ–¹æ¡ˆ
```typescript
// é€šçŸ¥æ¶ˆæ¯
interface NotificationMessage {
  type: 'NOTIFICATION';
  userId: string;
  notificationType: 'REVIEW_REMINDER' | 'ACHIEVEMENT' | 'STREAK_WARNING';
  title: string;
  content: string;
  channels: ('email' | 'push' | 'in-app')[];
  priority: 'low' | 'medium' | 'high';
  scheduledAt?: Date;
}

// å‘é€é€šçŸ¥
await messageQueue.send('notifications', {
  type: 'NOTIFICATION',
  userId: 'user123',
  notificationType: 'REVIEW_REMINDER',
  title: 'å¤ä¹ æ—¶é—´åˆ°äº†ï¼',
  content: 'ä½ æœ‰5ä¸ªå•è¯éœ€è¦å¤ä¹ ',
  channels: ['push', 'in-app'],
  priority: 'medium'
});
```

---

## ğŸ—„ï¸ æ•°æ®åº“è¯»å†™åˆ†ç¦»æ–¹æ¡ˆ

### 1. æ¶æ„è®¾è®¡

#### å½“å‰æ¶æ„é—®é¢˜
- æ‰€æœ‰è¯»å†™æ“ä½œéƒ½é›†ä¸­åœ¨å•ä¸ªMongoDBå®ä¾‹
- è¯»æ“ä½œå’Œå†™æ“ä½œç›¸äº’å½±å“
- é«˜å¹¶å‘æ—¶æ•°æ®åº“æˆä¸ºç“¶é¢ˆ

#### è¯»å†™åˆ†ç¦»æ¶æ„
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Next.js App   â”‚    â”‚   Load Balancer â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚                       â”‚
         â–¼                       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Write Database â”‚    â”‚  Read Database  â”‚
â”‚   (Primary)     â”‚    â”‚  (Secondary)    â”‚
â”‚   MongoDB       â”‚    â”‚   MongoDB       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚                       â”‚
         â–¼                       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Backup/Archive â”‚    â”‚  Analytics DB   â”‚
â”‚   MongoDB       â”‚    â”‚   MongoDB       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 2. æ•°æ®åˆ†ç¦»ç­–ç•¥

#### 2.1 è¯»å†™åˆ†ç¦»é…ç½®
```typescript
// æ•°æ®åº“è¿æ¥é…ç½®
const dbConfig = {
  // ä¸»æ•°æ®åº“ï¼ˆå†™æ“ä½œï¼‰
  primary: {
    uri: process.env.MONGODB_PRIMARY_URI,
    options: {
      readPreference: 'primary',
      writeConcern: { w: 'majority', j: true }
    }
  },
  // ä»æ•°æ®åº“ï¼ˆè¯»æ“ä½œï¼‰
  secondary: {
    uri: process.env.MONGODB_SECONDARY_URI,
    options: {
      readPreference: 'secondaryPreferred',
      maxPoolSize: 20
    }
  }
};

// æ•°æ®åº“è¿æ¥ç®¡ç†
class DatabaseManager {
  private primaryClient: MongoClient;
  private secondaryClient: MongoClient;

  async getWriteDatabase(): Promise<Db> {
    const client = await this.getPrimaryClient();
    return client.db(process.env.DATABASE_NAME);
  }

  async getReadDatabase(): Promise<Db> {
    const client = await this.getSecondaryClient();
    return client.db(process.env.DATABASE_NAME);
  }
}
```

#### 2.2 æ“ä½œåˆ†ç¦»
```typescript
// å†™æ“ä½œæœåŠ¡
class WriteService {
  static async createUser(userData: UserData): Promise<User> {
    const db = await databaseManager.getWriteDatabase();
    // å†™æ“ä½œé€»è¾‘
  }

  static async updateUserProgress(userId: string, progress: Progress): Promise<void> {
    const db = await databaseManager.getWriteDatabase();
    // å†™æ“ä½œé€»è¾‘
  }
}

// è¯»æ“ä½œæœåŠ¡
class ReadService {
  static async getUserById(userId: string): Promise<User | null> {
    const db = await databaseManager.getReadDatabase();
    // è¯»æ“ä½œé€»è¾‘
  }

  static async getWords(options: WordQueryOptions): Promise<Word[]> {
    const db = await databaseManager.getReadDatabase();
    // è¯»æ“ä½œé€»è¾‘
  }
}
```

### 3. æ•°æ®åŒæ­¥ç­–ç•¥

#### 3.1 å®æ—¶åŒæ­¥
```typescript
// ä½¿ç”¨MongoDB Change Streamså®ç°å®æ—¶åŒæ­¥
class DataSyncService {
  async startChangeStream(): Promise<void> {
    const db = await databaseManager.getWriteDatabase();
    
    const changeStream = db.watch([
      { $match: { operationType: { $in: ['insert', 'update', 'delete'] } } }
    ]);

    changeStream.on('change', async (change) => {
      await this.handleChange(change);
    });
  }

  private async handleChange(change: ChangeStreamDocument): Promise<void> {
    // æ ¹æ®å˜æ›´ç±»å‹åŒæ­¥åˆ°è¯»æ•°æ®åº“
    switch (change.operationType) {
      case 'insert':
        await this.syncInsert(change.fullDocument);
        break;
      case 'update':
        await this.syncUpdate(change.documentKey, change.updateDescription);
        break;
      case 'delete':
        await this.syncDelete(change.documentKey);
        break;
    }
  }
}
```

#### 3.2 æ‰¹é‡åŒæ­¥
```typescript
// å®šæ—¶æ‰¹é‡åŒæ­¥
class BatchSyncService {
  async syncUserStats(): Promise<void> {
    const writeDb = await databaseManager.getWriteDatabase();
    const readDb = await databaseManager.getReadDatabase();

    // è·å–éœ€è¦åŒæ­¥çš„ç”¨æˆ·ç»Ÿè®¡
    const users = await writeDb.collection('users').find({
      'stats.updatedAt': { $gte: new Date(Date.now() - 60000) } // æœ€è¿‘1åˆ†é’Ÿæ›´æ–°
    }).toArray();

    // æ‰¹é‡åŒæ­¥åˆ°è¯»æ•°æ®åº“
    for (const user of users) {
      await readDb.collection('users').replaceOne(
        { _id: user._id },
        user,
        { upsert: true }
      );
    }
  }
}
```

### 4. è´Ÿè½½å‡è¡¡é…ç½®

#### 4.1 è¯»æ“ä½œè´Ÿè½½å‡è¡¡
```typescript
// è¯»æ“ä½œè´Ÿè½½å‡è¡¡
class ReadLoadBalancer {
  private readClients: MongoClient[] = [];
  private currentIndex = 0;

  async getReadDatabase(): Promise<Db> {
    const client = this.getNextReadClient();
    return client.db(process.env.DATABASE_NAME);
  }

  private getNextReadClient(): MongoClient {
    const client = this.readClients[this.currentIndex];
    this.currentIndex = (this.currentIndex + 1) % this.readClients.length;
    return client;
  }
}
```

#### 4.2 å¥åº·æ£€æŸ¥
```typescript
// æ•°æ®åº“å¥åº·æ£€æŸ¥
class HealthCheckService {
  async checkPrimaryHealth(): Promise<boolean> {
    try {
      const db = await databaseManager.getWriteDatabase();
      await db.admin().ping();
      return true;
    } catch (error) {
      console.error('Primary database health check failed:', error);
      return false;
    }
  }

  async checkSecondaryHealth(): Promise<boolean> {
    try {
      const db = await databaseManager.getReadDatabase();
      await db.admin().ping();
      return true;
    } catch (error) {
      console.error('Secondary database health check failed:', error);
      return false;
    }
  }
}
```

---

## ğŸ—ï¸ æŠ€æœ¯æ¶æ„è®¾è®¡

### 1. æ¶ˆæ¯é˜Ÿåˆ—æ¶æ„

#### 1.1 é˜Ÿåˆ—é€‰æ‹©
- **Redis Streams**: è½»é‡çº§ï¼Œé€‚åˆç®€å•åœºæ™¯
- **RabbitMQ**: åŠŸèƒ½ä¸°å¯Œï¼Œé€‚åˆå¤æ‚æ¶ˆæ¯è·¯ç”±
- **Apache Kafka**: é«˜ååé‡ï¼Œé€‚åˆå¤§æ•°æ®åœºæ™¯

#### æ¨èæ–¹æ¡ˆï¼šRedis Streams
```typescript
// Redis Streams é…ç½®
const redisConfig = {
  host: process.env.REDIS_HOST || 'localhost',
  port: parseInt(process.env.REDIS_PORT || '6379'),
  password: process.env.REDIS_PASSWORD,
  db: parseInt(process.env.REDIS_DB || '0')
};

// æ¶ˆæ¯é˜Ÿåˆ—æœåŠ¡
class MessageQueueService {
  private redis: Redis;

  async sendMessage(stream: string, message: any): Promise<string> {
    return await this.redis.xadd(stream, '*', 'data', JSON.stringify(message));
  }

  async consumeMessages(stream: string, consumerGroup: string, consumer: string): Promise<void> {
    while (true) {
      const messages = await this.redis.xreadgroup(
        'GROUP', consumerGroup, consumer,
        'COUNT', 10,
        'BLOCK', 1000,
        'STREAMS', stream, '>'
      );

      for (const message of messages[0].messages) {
        await this.processMessage(message);
      }
    }
  }
}
```

#### 1.2 æ¶ˆæ¯å¤„ç†æœåŠ¡
```typescript
// å­¦ä¹ è¿›åº¦å¤„ç†å™¨
class LearningProgressProcessor {
  async processMessage(message: any): Promise<void> {
    const data = JSON.parse(message.data);
    
    switch (data.type) {
      case 'PROGRESS_UPDATE':
        await this.updateProgress(data);
        break;
      case 'STATS_UPDATE':
        await this.updateStats(data);
        break;
    }
  }

  private async updateProgress(data: LearningProgressMessage): Promise<void> {
    // æ›´æ–°å­¦ä¹ è¿›åº¦
    await WriteService.updateUserProgress(data.userId, data.wordId, data.isCorrect);
    
    // è§¦å‘ç»Ÿè®¡æ›´æ–°
    await messageQueue.send('user-stats', {
      type: 'STATS_UPDATE',
      userId: data.userId,
      statsType: 'daily',
      data: { wordsLearned: 1, studyTime: 60 }
    });
  }
}
```

### 2. æ•°æ®åº“è¯»å†™åˆ†ç¦»æ¶æ„

#### 2.1 Docker Compose é…ç½®
```yaml
# docker-compose.prod.yml
version: '3.8'

services:
  # ä¸»æ•°æ®åº“ï¼ˆå†™æ“ä½œï¼‰
  mongodb-primary:
    image: mongo:7.0
    container_name: wordmaster-mongodb-primary
    environment:
      MONGO_INITDB_ROOT_USERNAME: ${MONGO_ROOT_USERNAME}
      MONGO_INITDB_ROOT_PASSWORD: ${MONGO_ROOT_PASSWORD}
      MONGO_INITDB_DATABASE: ${DATABASE_NAME}
    ports:
      - "27017:27017"
    volumes:
      - mongodb_primary_data:/data/db
      - ./mongo-init:/docker-entrypoint-initdb.d
    command: mongod --replSet rs0 --bind_ip_all

  # ä»æ•°æ®åº“ï¼ˆè¯»æ“ä½œï¼‰
  mongodb-secondary:
    image: mongo:7.0
    container_name: wordmaster-mongodb-secondary
    environment:
      MONGO_INITDB_ROOT_USERNAME: ${MONGO_ROOT_USERNAME}
      MONGO_INITDB_ROOT_PASSWORD: ${MONGO_ROOT_PASSWORD}
      MONGO_INITDB_DATABASE: ${DATABASE_NAME}
    ports:
      - "27018:27017"
    volumes:
      - mongodb_secondary_data:/data/db
    command: mongod --replSet rs0 --bind_ip_all
    depends_on:
      - mongodb-primary

  # Redis æ¶ˆæ¯é˜Ÿåˆ—
  redis:
    image: redis:7.2-alpine
    container_name: wordmaster-redis
    ports:
      - "6379:6379"
    volumes:
      - redis_data:/data
    command: redis-server --appendonly yes

  # æ¶ˆæ¯å¤„ç†å™¨
  message-processor:
    build: .
    container_name: wordmaster-message-processor
    environment:
      - NODE_ENV=production
      - MONGODB_PRIMARY_URI=${MONGODB_PRIMARY_URI}
      - MONGODB_SECONDARY_URI=${MONGODB_SECONDARY_URI}
      - REDIS_HOST=redis
    depends_on:
      - mongodb-primary
      - mongodb-secondary
      - redis
    command: npm run start:message-processor

volumes:
  mongodb_primary_data:
  mongodb_secondary_data:
  redis_data:
```

#### 2.2 ç¯å¢ƒå˜é‡é…ç½®
```bash
# .env.production
# æ•°æ®åº“é…ç½®
MONGODB_PRIMARY_URI=mongodb://root:password@mongodb-primary:27017/wordmaster?authSource=admin
MONGODB_SECONDARY_URI=mongodb://root:password@mongodb-secondary:27017/wordmaster?authSource=admin

# Redis é…ç½®
REDIS_HOST=redis
REDIS_PORT=6379
REDIS_PASSWORD=
REDIS_DB=0

# æ¶ˆæ¯é˜Ÿåˆ—é…ç½®
MESSAGE_QUEUE_REDIS_HOST=redis
MESSAGE_QUEUE_REDIS_PORT=6379
```

---

## ğŸ“… å®æ–½è®¡åˆ’

### ç¬¬ä¸€é˜¶æ®µï¼šæ¶ˆæ¯é˜Ÿåˆ—åŸºç¡€æ­å»ºï¼ˆ1-2å‘¨ï¼‰

#### 1.1 åŸºç¡€è®¾æ–½
- [ ] æ­å»ºRedisæ¶ˆæ¯é˜Ÿåˆ—
- [ ] å®ç°åŸºç¡€æ¶ˆæ¯å‘é€/æ¥æ”¶åŠŸèƒ½
- [ ] åˆ›å»ºæ¶ˆæ¯å¤„ç†å™¨æ¡†æ¶

#### 1.2 å­¦ä¹ è¿›åº¦å¼‚æ­¥åŒ–
- [ ] å­¦ä¹ è¿›åº¦æ›´æ–°å¼‚æ­¥åŒ–
- [ ] ç”¨æˆ·ç»Ÿè®¡è®¡ç®—å¼‚æ­¥åŒ–
- [ ] è‰¾å®¾æµ©æ–¯ç®—æ³•å¼‚æ­¥å¤„ç†

#### 1.3 æµ‹è¯•éªŒè¯
- [ ] å•å…ƒæµ‹è¯•
- [ ] é›†æˆæµ‹è¯•
- [ ] æ€§èƒ½æµ‹è¯•

### ç¬¬äºŒé˜¶æ®µï¼šæ•°æ®åº“è¯»å†™åˆ†ç¦»ï¼ˆ2-3å‘¨ï¼‰

#### 2.1 æ•°æ®åº“æ¶æ„
- [ ] æ­å»ºä¸»ä»æ•°æ®åº“
- [ ] é…ç½®æ•°æ®åŒæ­¥
- [ ] å®ç°è¯»å†™åˆ†ç¦»æœåŠ¡

#### 2.2 åº”ç”¨å±‚æ”¹é€ 
- [ ] ä¿®æ”¹æ•°æ®è®¿é—®å±‚
- [ ] å®ç°è´Ÿè½½å‡è¡¡
- [ ] æ·»åŠ å¥åº·æ£€æŸ¥

#### 2.3 æ•°æ®è¿ç§»
- [ ] æ•°æ®è¿ç§»è„šæœ¬
- [ ] æ•°æ®ä¸€è‡´æ€§éªŒè¯
- [ ] å›æ»šæ–¹æ¡ˆ

### ç¬¬ä¸‰é˜¶æ®µï¼šä¼˜åŒ–ä¸ç›‘æ§ï¼ˆ1-2å‘¨ï¼‰

#### 3.1 æ€§èƒ½ä¼˜åŒ–
- [ ] ç¼“å­˜ç­–ç•¥ä¼˜åŒ–
- [ ] æ¶ˆæ¯é˜Ÿåˆ—æ€§èƒ½è°ƒä¼˜
- [ ] æ•°æ®åº“è¿æ¥æ± ä¼˜åŒ–

#### 3.2 ç›‘æ§ç³»ç»Ÿ
- [ ] æ¶ˆæ¯é˜Ÿåˆ—ç›‘æ§
- [ ] æ•°æ®åº“æ€§èƒ½ç›‘æ§
- [ ] åº”ç”¨æ€§èƒ½ç›‘æ§

#### 3.3 è¿ç»´å·¥å…·
- [ ] è‡ªåŠ¨åŒ–éƒ¨ç½²è„šæœ¬
- [ ] æ•…éšœæ¢å¤å·¥å…·
- [ ] æ•°æ®å¤‡ä»½ç­–ç•¥

---

## ğŸ“Š ç›‘æ§ä¸è¿ç»´

### 1. æ¶ˆæ¯é˜Ÿåˆ—ç›‘æ§

#### 1.1 å…³é”®æŒ‡æ ‡
```typescript
// æ¶ˆæ¯é˜Ÿåˆ—ç›‘æ§æŒ‡æ ‡
interface QueueMetrics {
  // æ¶ˆæ¯å¤„ç†æŒ‡æ ‡
  messagesProcessed: number;
  messagesFailed: number;
  averageProcessingTime: number;
  
  // é˜Ÿåˆ—çŠ¶æ€æŒ‡æ ‡
  queueLength: number;
  consumerLag: number;
  errorRate: number;
  
  // ç³»ç»Ÿèµ„æºæŒ‡æ ‡
  memoryUsage: number;
  cpuUsage: number;
  connectionCount: number;
}
```

#### 1.2 ç›‘æ§å®ç°
```typescript
// ç›‘æ§æœåŠ¡
class QueueMonitoringService {
  async collectMetrics(): Promise<QueueMetrics> {
    const redis = await this.getRedisClient();
    
    return {
      messagesProcessed: await redis.get('metrics:messages:processed') || 0,
      messagesFailed: await redis.get('metrics:messages:failed') || 0,
      averageProcessingTime: await redis.get('metrics:processing:avg_time') || 0,
      queueLength: await redis.xlen('learning-progress'),
      consumerLag: await this.calculateConsumerLag(),
      errorRate: await this.calculateErrorRate(),
      memoryUsage: await redis.memory('usage'),
      cpuUsage: await this.getCpuUsage(),
      connectionCount: await redis.client('list').length
    };
  }
}
```

### 2. æ•°æ®åº“ç›‘æ§

#### 2.1 è¯»å†™åˆ†ç¦»ç›‘æ§
```typescript
// æ•°æ®åº“ç›‘æ§æŒ‡æ ‡
interface DatabaseMetrics {
  // è¿æ¥æŒ‡æ ‡
  primaryConnections: number;
  secondaryConnections: number;
  
  // æ€§èƒ½æŒ‡æ ‡
  primaryResponseTime: number;
  secondaryResponseTime: number;
  
  // åŒæ­¥æŒ‡æ ‡
  replicationLag: number;
  syncStatus: 'healthy' | 'warning' | 'error';
  
  // èµ„æºæŒ‡æ ‡
  primaryMemoryUsage: number;
  secondaryMemoryUsage: number;
}
```

#### 2.2 å¥åº·æ£€æŸ¥
```typescript
// å¥åº·æ£€æŸ¥æœåŠ¡
class DatabaseHealthService {
  async checkHealth(): Promise<HealthStatus> {
    const primaryHealth = await this.checkPrimaryHealth();
    const secondaryHealth = await this.checkSecondaryHealth();
    const syncHealth = await this.checkSyncHealth();
    
    return {
      primary: primaryHealth,
      secondary: secondaryHealth,
      sync: syncHealth,
      overall: this.calculateOverallHealth(primaryHealth, secondaryHealth, syncHealth)
    };
  }
}
```

### 3. å‘Šè­¦ç³»ç»Ÿ

#### 3.1 å‘Šè­¦è§„åˆ™
```typescript
// å‘Šè­¦è§„åˆ™é…ç½®
const alertRules = {
  // æ¶ˆæ¯é˜Ÿåˆ—å‘Šè­¦
  queueAlerts: {
    queueLength: { threshold: 1000, severity: 'warning' },
    errorRate: { threshold: 0.05, severity: 'critical' },
    processingTime: { threshold: 5000, severity: 'warning' }
  },
  
  // æ•°æ®åº“å‘Šè­¦
  databaseAlerts: {
    replicationLag: { threshold: 30, severity: 'warning' },
    connectionCount: { threshold: 100, severity: 'warning' },
    responseTime: { threshold: 1000, severity: 'warning' }
  }
};
```

#### 3.2 å‘Šè­¦é€šçŸ¥
```typescript
// å‘Šè­¦é€šçŸ¥æœåŠ¡
class AlertService {
  async sendAlert(alert: Alert): Promise<void> {
    // å‘é€é‚®ä»¶
    await this.sendEmail(alert);
    
    // å‘é€çŸ­ä¿¡
    if (alert.severity === 'critical') {
      await this.sendSMS(alert);
    }
    
    // å‘é€Slacké€šçŸ¥
    await this.sendSlack(alert);
  }
}
```

---

## ğŸ¯ æ€»ç»“

### æ€§èƒ½æå‡é¢„æœŸ

#### æ¶ˆæ¯é˜Ÿåˆ—ä¼˜åŒ–
- **å“åº”æ—¶é—´**: å­¦ä¹ è¿›åº¦æ›´æ–°ä» 100-200ms é™ä½åˆ° 10-20ms
- **å¹¶å‘èƒ½åŠ›**: æ”¯æŒ 10x æ›´é«˜çš„å¹¶å‘å­¦ä¹ è¿›åº¦æ›´æ–°
- **ç³»ç»Ÿç¨³å®šæ€§**: å¼‚æ­¥å¤„ç†æå‡ç³»ç»Ÿç¨³å®šæ€§

#### è¯»å†™åˆ†ç¦»ä¼˜åŒ–
- **è¯»æ€§èƒ½**: è¯»æ“ä½œå“åº”æ—¶é—´æå‡ 3-5 å€
- **å†™æ€§èƒ½**: å†™æ“ä½œä¸å—è¯»æ“ä½œå½±å“
- **å¹¶å‘èƒ½åŠ›**: æ•´ä½“å¹¶å‘å¤„ç†èƒ½åŠ›æå‡ 5-10 å€

### æˆæœ¬æ•ˆç›Šåˆ†æ

#### ç¡¬ä»¶æˆæœ¬
- **RedisæœåŠ¡å™¨**: æ¯æœˆ $30-100
- **é¢å¤–æ•°æ®åº“å®ä¾‹**: æ¯æœˆ $100-300
- **ç›‘æ§å·¥å…·**: æ¯æœˆ $50-150

#### æ”¶ç›Š
- **ç”¨æˆ·ä½“éªŒ**: æ˜¾è‘—æå‡å“åº”é€Ÿåº¦å’Œç¨³å®šæ€§
- **å¼€å‘æ•ˆç‡**: å¼‚æ­¥å¤„ç†ç®€åŒ–ä¸šåŠ¡é€»è¾‘
- **è¿ç»´æ•ˆç‡**: è¯»å†™åˆ†ç¦»æå‡ç³»ç»Ÿå¯ç»´æŠ¤æ€§

### å®æ–½å»ºè®®

1. **ä¼˜å…ˆçº§**: å…ˆå®æ–½æ¶ˆæ¯é˜Ÿåˆ—ï¼Œå†å®æ–½è¯»å†™åˆ†ç¦»
2. **æ¸è¿›å¼**: é€æ­¥è¿ç§»ï¼Œç¡®ä¿ç³»ç»Ÿç¨³å®šæ€§
3. **ç›‘æ§**: å®Œå–„çš„ç›‘æ§å’Œå‘Šè­¦ç³»ç»Ÿ
4. **æµ‹è¯•**: å……åˆ†çš„æµ‹è¯•éªŒè¯

é€šè¿‡æ¶ˆæ¯é˜Ÿåˆ—å’Œè¯»å†™åˆ†ç¦»çš„å®æ–½ï¼Œç³»ç»Ÿå°†è·å¾—æ˜¾è‘—çš„æ€§èƒ½æå‡å’Œæ›´å¥½çš„å¯æ‰©å±•æ€§ï¼Œä¸ºç”¨æˆ·æä¾›æ›´ä¼˜è´¨çš„å­¦ä¹ ä½“éªŒã€‚
